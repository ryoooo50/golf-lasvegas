# Golf Las Vegas App - Specification Document (Rev. 2)

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã‚´ãƒ«ãƒ•ã®è³­ã‘ãƒ«ãƒ¼ãƒ«ã€Œãƒ©ã‚¹ãƒ™ã‚¬ã‚¹ã€ã®è¨ˆç®—ã‚’ç®¡ç†ã™ã‚‹ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚¢ãƒ—ãƒªï¼ˆMVPï¼‰ã‚’é–‹ç™ºã™ã‚‹ã€‚
ç‹¬è‡ªã®ã€Œãƒ—ãƒƒã‚·ãƒ¥ã€ãƒ«ãƒ¼ãƒ«ã‚„ã€Œã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ã€ã€ç‰¹æ®Šãªã€Œãƒãƒ¼ãƒ‡ã‚£ãƒ¼å‡¦ç†ã€ã‚’å«ã¿ã€ãƒ©ã‚¦ãƒ³ãƒ‰ä¸­ã®è¤‡é›‘ãªè¨ˆç®—ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯é¸å®š

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®æŒ‡ç¤ºã¨ã—ã¦ä»¥ä¸‹ã‚’æ¨å¥¨ã™ã‚‹ã€‚

- **Framework**: React Native (Expo) - iOS/Androidä¸¡å¯¾å¿œã€é–‹ç™ºé€Ÿåº¦é‡è¦–
- **Language**: TypeScript
- **State Management**: React Context API or Zustand
- **UI Library**: React Native Paper, Tamagui, or NativeBase
- **Persistence**: AsyncStorage (ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–)

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« (TypeScript Interface)

å¤‰æ›´ã«å¼·ãã€ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ç­‰ã®çŠ¶æ…‹ç®¡ç†ã‚’è¡Œãˆã‚‹è¨­è¨ˆã¨ã™ã‚‹ã€‚

```typescript
type PlayerId = string;

interface Player {
  id: PlayerId;
  name: string;
  pushUsageCount: {
    front9: number; // OUT (1-9)
    back9: number;  // IN (10-18)
  };
}

interface ScoreInput {
  score: number;
  isBirdie: boolean; // ãƒãƒ¼ãƒ‡ã‚£ãƒ¼ä»¥ä¸Šãªã‚‰true
  usePush: boolean;  // ã“ã®ãƒ›ãƒ¼ãƒ«ã§ãƒ—ãƒƒã‚·ãƒ¥æ¨©ã‚’è¡Œä½¿ã™ã‚‹ã‹
}

interface HoleResult {
  holeNumber: number; // 1-18
  par: number;
  scores: Record<PlayerId, ScoreInput>;
  
  // ãƒšã‚¢åˆ†ã‘æƒ…å ±
  teamA_Ids: [PlayerId, PlayerId]; 
  teamB_Ids: [PlayerId, PlayerId];
  
  // è¨ˆç®—ç”¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  carryOverMultiplier: number; // ã“ã®ãƒ›ãƒ¼ãƒ«ã«é©ç”¨ã•ã‚Œã‚‹ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼å€ç‡ (é€šå¸¸1)
  isDraw: boolean; // å¼•ãåˆ†ã‘ã ã£ãŸå ´åˆï¼ˆæ¬¡å›ã¸ã®ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ç™ºç”Ÿãƒ•ãƒ©ã‚°ï¼‰
  
  // è¨ˆç®—ç¢ºå®šå¾Œã®ãƒã‚¤ãƒ³ãƒˆå¤‰å‹• (èª°ãŒèª°ã«ä½•ãƒã‚¤ãƒ³ãƒˆæ‰•ã†/è²°ã†ã‹)
  // ãƒ—ãƒ©ã‚¹ã¯å—å–ã€ãƒã‚¤ãƒŠã‚¹ã¯æ”¯æ‰•
  pointsResult: Record<PlayerId, number>; 
}

interface GameState {
  players: Player[];
  currentHole: number;
  history: HoleResult[];
  
  // è¨­å®š
  settings: {
    rate: number; // å˜ä½ãªã—
    maxPushCountPerHalf: number; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ2
  };
  
  // æ¬¡ã®ãƒ›ãƒ¼ãƒ«ã«æŒã¡è¶Šã•ã‚Œã¦ã„ã‚‹å€ç‡ï¼ˆåˆæœŸå€¤1, å¼•ãåˆ†ã‘ç™ºç”Ÿã§ x2, x4...ï¼‰
  nextHoleMultiplier: number; 
}
```

## 4. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¨ˆç®—ãƒ«ãƒ¼ãƒ«è©³ç´°ï¼‰

### 4.1. ãƒãƒ¼ãƒ ã‚¹ã‚³ã‚¢ã®é€£çµã¨ãƒ•ãƒªãƒƒãƒ—ï¼ˆãƒãƒ¼ãƒ‡ã‚£ãƒ¼å‡¦ç†ï¼‰

**åŸºæœ¬é€£çµ:**

å„ãƒãƒ¼ãƒ 2åã®ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã™ã‚‹ã€‚

- **é€šå¸¸æ™‚**: `min(score1, score2)` ã‚’10ã®ä½ã€`max(score1, score2)` ã‚’1ã®ä½ã¨ã™ã‚‹ã€‚
- ä¾‹: A(4), B(5) -> 45

**ãƒãƒ¼ãƒ‡ã‚£ãƒ¼ã«ã‚ˆã‚‹ãƒ•ãƒªãƒƒãƒ— (Flip):**

- **ãƒ«ãƒ¼ãƒ«**: ã€Œãƒãƒ¼ãƒ‡ã‚£ãƒ¼ã‚’å–ã£ãŸãƒãƒ¼ãƒ ã®ç›¸æ‰‹ãƒãƒ¼ãƒ ã€ã¯ã€ã‚¹ã‚³ã‚¢ã®1ã®ä½ã¨10ã®ä½ãŒå…¥ã‚Œæ›¿ã‚ã‚‹ï¼ˆå¤§ãã„æ•°å­—ãŒ10ã®ä½ã«æ¥ã‚‹ï¼‰ã€‚
- ä¾‹: ãƒãƒ¼ãƒ AãŒãƒãƒ¼ãƒ‡ã‚£ãƒ¼ã€‚ãƒãƒ¼ãƒ Bã®ã‚¹ã‚³ã‚¢ã¯ (4, 6)ã€‚
  - é€šå¸¸ã®ãƒãƒ¼ãƒ Bã‚¹ã‚³ã‚¢: 46
  - ãƒ•ãƒªãƒƒãƒ—å¾Œã®ãƒãƒ¼ãƒ Bã‚¹ã‚³ã‚¢: 64

**ç›¸æ®ºãƒ«ãƒ¼ãƒ«**: ä¸¡ãƒãƒ¼ãƒ ã«ãƒãƒ¼ãƒ‡ã‚£ãƒ¼ãŒå‡ºãŸå ´åˆã€ä¸¡ãƒãƒ¼ãƒ ã¨ã‚‚ãƒ•ãƒªãƒƒãƒ—ã™ã‚‹ï¼ˆã¾ãŸã¯ç›¸æ®ºã—ã¦é€šå¸¸é€šã‚Šã¨ã™ã‚‹ã‹ã¯å®Ÿè£…æ™‚ã«é¸æŠå¯èƒ½ã«ã™ã‚‹ãŒã€MVPã§ã¯ã€Œæ¡ä»¶ã‚’æº€ãŸã›ã°ãƒ•ãƒªãƒƒãƒ—ã€ã¨ã„ã†å˜ç´”ãƒ«ãƒ¼ãƒ«ã‚’æ¡ç”¨ã—ã€ä¸¡ãƒãƒ¼ãƒ ãƒ•ãƒªãƒƒãƒ—ã¨ã™ã‚‹ï¼‰ã€‚

### 4.2. å‹æ•—ã¨åŸºæœ¬ãƒã‚¤ãƒ³ãƒˆç®—å‡º

`Diff = |TeamA_Score - TeamB_Score|`

å¾—ç‚¹ãŒä½ã„ï¼ˆã‚´ãƒ«ãƒ•ã¨ã—ã¦è‰¯ã„ã‚¹ã‚³ã‚¢ï¼‰ãƒãƒ¼ãƒ ãŒå‹åˆ©ã€‚

### 4.3. å€ç‡è¨ˆç®— (Multiplier Logic)

æœ€çµ‚çš„ãªãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®å¼ã§ç®—å‡ºã™ã‚‹ã€‚

$$ \text{FinalPoint} = \text{Diff} \times \text{PushMultiplier} \times \text{CarryOverMultiplier} $$

#### A. ãƒ—ãƒƒã‚·ãƒ¥å€ç‡ (PushMultiplier)

å‚åŠ è€…å…¨å“¡ã® `usePush` ãƒ•ãƒ©ã‚°ã®åˆè¨ˆæ•° (`totalPushCount`) ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚

**è¨ˆç®—å¼:**

- `totalPushCount == 0` ã®å ´åˆ: 1å€
- `totalPushCount > 0` ã®å ´åˆ: `2 * totalPushCount` å€
  - 1äººãƒ—ãƒƒã‚·ãƒ¥: 2å€
  - 2äººãƒ—ãƒƒã‚·ãƒ¥: 4å€
  - 3äººãƒ—ãƒƒã‚·ãƒ¥: 6å€
  - 4äººãƒ—ãƒƒã‚·ãƒ¥: 8å€

#### B. ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼å€ç‡ (CarryOverMultiplier)

å‰ã®ãƒ›ãƒ¼ãƒ«ã‹ã‚‰ã®æŒã¡è¶Šã—å€ç‡ã€‚

- é€šå¸¸ã¯ 1å€ã€‚
- å‰ãƒ›ãƒ¼ãƒ«ãŒå¼•ãåˆ†ã‘ã®å ´åˆã€2å€ ã«ãªã‚‹ã€‚é€£ç¶šå¼•ãåˆ†ã‘ã®å ´åˆã¯ 4å€, 6å€, 8å€ ã¨ã€Œå¼•ãåˆ†ã‘é€£ç¶šå›æ•° Ã— 2ã€ã§å¢—åŠ ã™ã‚‹ã€‚

### 4.4. å¼•ãåˆ†ã‘ (Draw) ã®å‡¦ç†

`TeamA_Score == TeamB_Score` ã®å ´åˆ:

- ãã®ãƒ›ãƒ¼ãƒ«ã® `pointsResult` ã¯å…¨å“¡ 0 ã¨ã™ã‚‹ã€‚
- `nextHoleMultiplier` ã‚’æ›´æ–°ã™ã‚‹ã€‚
  - ç¾åœ¨ãŒ 1å€ (é€šå¸¸) ã®å ´åˆ â†’ 2å€ ã«ã™ã‚‹ã€‚
  - ç¾åœ¨ãŒ 2å€ä»¥ä¸Š (ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ä¸­) ã®å ´åˆ â†’ ç¾åœ¨ã®å€ç‡ + 2 ã‚’åŠ ç®—ã™ã‚‹ã€‚
  - (ä¾‹: 2å€â†’4å€ã€4å€â†’6å€ã€6å€â†’8å€)

å‹æ•—ãŒã¤ã„ãŸå ´åˆ:

- è¨ˆç®—ã‚’å®Ÿè¡Œã—ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºå®šã€‚
- `nextHoleMultiplier` ã‚’ 1 ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã€‚

## 5. UI/UX è¦ä»¶

### 5.1. å…¥åŠ›ç”»é¢ (Score Input)

**ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤º:**

ç¾åœ¨ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ä¸­ï¼ˆå€ç‡ãŒã‹ã‹ã£ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰ã§ã‚ã‚‹ã“ã¨ã‚’ç›®ç«‹ã¤ã‚ˆã†ã«è¡¨ç¤ºã™ã‚‹ï¼ˆä¾‹: ğŸ”¥ Rate x2 ğŸ”¥ï¼‰ã€‚

**ã‚¹ã‚³ã‚¢å…¥åŠ›:**

- 4äººåˆ†ã®ã‚¹ã‚³ã‚¢å…¥åŠ›è¡Œã€‚
- **Birdie Checkbox**: ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ã€UIä¸Šã§ã€Œç›¸æ‰‹ãƒãƒ¼ãƒ ã¸ã®æ”»æ’ƒï¼ˆFlipï¼‰ã€ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’è¦–è¦šçš„ã«ç¤ºå”†ã™ã‚‹ã¨è‰¯ã„ï¼ˆMVPã§ã¯ãƒã‚§ãƒƒã‚¯ã®ã¿ã§OKï¼‰ã€‚

**Push Toggle:**

- ãƒãƒ¼ãƒ•ã”ã¨ã®æ®‹ã‚Šå›æ•° (`maxPushCountPerHalf` - `usedCount`) ã‚’è¡¨ç¤ºã€‚
- æ®‹ã‚Šå›æ•°ãŒ0ãªã‚‰é¸æŠä¸å¯(Disabled)ã€‚

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äºˆæ¸¬:**

ã‚¹ã‚³ã‚¢ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹æœ€ä¸­ã«ã€ã€Œç¾åœ¨ã®å…¥åŠ›ã ã¨ã©ã¡ã‚‰ãŒå‹ã¤ã‹ã€ä½•ãƒã‚¤ãƒ³ãƒˆå‹•ãã‹ã€ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹ï¼ˆè¨ˆç®—ãƒŸã‚¹é˜²æ­¢ã®ãŸã‚ï¼‰ã€‚

### 5.2. çµæœè¡¨ç¤º

**è©³ç´°å†…è¨³:**

ãªãœãã®ãƒã‚¤ãƒ³ãƒˆã«ãªã£ãŸã®ã‹ã®å¼ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

- ä¾‹: `(64 - 45) Ã— Push(4å€) Ã— CarryOver(2å€) = 152 pts`
- ç‰¹ã«ãƒãƒ¼ãƒ‡ã‚£ãƒ¼ã«ã‚ˆã‚‹ã‚¹ã‚³ã‚¢å…¥ã‚Œæ›¿ãˆï¼ˆ46 -> 64ï¼‰ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ãã‚ŒãŒã‚ã‹ã‚‹ã‚ˆã†ã«å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚

### 5.3. è¨­å®šå¤‰æ›´

ãƒ—ãƒƒã‚·ãƒ¥ã®ä¸Šé™å›æ•°ã‚„ã€ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ã®æœ‰ç„¡ãªã©ã¯å¤‰æ›´å¯èƒ½ã«ã™ã‚‹è¨­è¨ˆã¨ã—ã¦ãŠãã“ã¨ã€‚

## 6. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ— (Agentã¸ã®æŒ‡ç¤º)

1. **Core Logic**: `calculateHoleResult` é–¢æ•°ã‚’æœ€åˆã«å®Ÿè£…ã—ã€å˜ä½“ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ï¼ˆç‰¹ã«ãƒãƒ¼ãƒ‡ã‚£ãƒ¼ã®ãƒ•ãƒªãƒƒãƒ—ã€ãƒ—ãƒƒã‚·ãƒ¥å€ç‡ã€ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ç¢ºèªã®ãŸã‚ï¼‰ã€‚
2. **State**: Context APIç­‰ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ä½œæˆã€‚
3. **UI**: å…¥åŠ›ç”»é¢ -> çµæœãƒ¢ãƒ¼ãƒ€ãƒ« -> å±¥æ­´ç”»é¢ ã®é †ã§å®Ÿè£…ã€‚